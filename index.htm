<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pokédex Cloud & TCG</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* Mantendo seu layout original conforme solicitado */
    :root {
      --user-color-1: #ef4444; --user-color-2: #3b82f6;
      --bg-gradient: linear-gradient(135deg, var(--user-color-1), var(--user-color-2));
      --card-bg: #ffffff; --text-main: #374151; --input-border: #d1d5db; --pokedex-item-bg: #ffffff;
    }
    body.dark-mode {
      --bg-gradient: linear-gradient(135deg, #1f2937, #111827);
      --card-bg: #1f2937; --text-main: #f3f4f6; --input-border: #4b5563; --pokedex-item-bg: #374151;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; min-height: 100vh; background: var(--bg-gradient); background-attachment: fixed; font-family: 'Segoe UI', sans-serif; padding: 15px; color: var(--text-main); transition: background 0.4s; }

    .card { background: var(--card-bg); border-radius: 20px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    .card-login { width: 100%; max-width: 400px; margin: 40px auto; text-align: center; }
    input { width: 100%; height: 50px; padding: 0 15px; border-radius: 12px; border: 2px solid var(--input-border); background: var(--card-bg); color: var(--text-main); font-size: 16px; margin-bottom: 10px; }
    
    .grid-pokemon { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; padding-bottom: 40px; }
    .pokemon-card { background: var(--pokedex-item-bg); border-radius: 15px; padding: 12px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
    .pokemon-card img { width: 80px; height: 80px; }
    .pokemon-card.capturado { background: linear-gradient(135deg, #a8ff78, #78ffd6) !important; border: 2px solid #2ecc71; }

    /* MODAL TCG */
    #modal-tcg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; padding: 15px; }
    .modal-content { background: var(--card-bg); width: 100%; max-width: 500px; height: 80vh; border-radius: 25px; display: flex; flex-direction: column; }
    .modal-body { flex: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .carta-item { background: rgba(0,0,0,0.05); padding: 5px; border-radius: 10px; text-align: center; }
    .carta-item img { width: 100%; border-radius: 5px; }

    #btn-topo { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #ef4444; color: white; border: none; font-size: 24px; display: none; cursor: pointer; }
  </style>
</head>
<body>

  <div id="secao-login">
    <div class="card card-login">
      <h1 style="font-family:'Press Start 2P'; color:#ffcb05; text-shadow:2px 2px #2a75bb">POKÉDEX</h1>
      <input type="text" id="user" placeholder="Treinador">
      <input type="password" id="pass" placeholder="Senha">
      <button class="card" style="width:100%; background:#ef4444; color:white; font-weight:bold; cursor:pointer" id="btnLogin">ENTRAR</button>
      <p id="error" style="color:red"></p>
    </div>
  </div>

  <div id="app" style="display:none">
    <div class="card" style="margin-bottom:15px">
      <h2 id="welcome" style="margin:0 0 10px 0"></h2>
      <input type="text" id="search" placeholder="Buscar Pokémon ou Pacote...">
    </div>
    <div id="lista-pokemon" class="grid-pokemon"></div>
  </div>

  <div id="modal-tcg" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div style="padding:20px; border-bottom:1px solid #ddd; font-weight:bold" id="modal-titulo">Cartas</div>
      <div class="modal-body" id="modal-lista"></div>
    </div>
  </div>

  <button id="btn-topo" onclick="window.scrollTo(0,0)">↑</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Suas configurações extraídas da imagem
    const firebaseConfig = {
      apiKey: "AIzaSyA9QSBF_caNWZjTkhZ0wsQbOV_WDu hzZpU",
      authDomain: "pokedextcg-5232f.firebaseapp.com",
      projectId: "pokedextcg-5232f",
      storageBucket: "pokedextcg-5232f.firebasestorage.app",
      messagingSenderId: "184284811506",
      appId: "1:184284811506:web:51e49727b89e750de4006b",
      measurementId: "G-WHK7TP29QM"
    };

    const fb = initializeApp(firebaseConfig);
    const db = getFirestore(fb);
    let userDoc = null;
    let listaNomes = {};

    // Carregar nomes da API
    const init = async () => {
      const res = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1025');
      const data = await res.json();
      data.results.forEach((p, i) => listaNomes[i + 1] = p.name);
    };

    // Login e Sincronização
    document.getElementById('btnLogin').onclick = async () => {
      const u = document.getElementById('user').value.toLowerCase().trim();
      if(!u) return;
      
      const docRef = doc(db, "treinadores", u);
      const snap = await getDoc(docRef);
      
      if(snap.exists()) {
        userDoc = snap.data();
      } else {
        userDoc = { nome: u, capturados: {} };
        await setDoc(docRef, userDoc);
      }
      
      document.getElementById('secao-login').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      document.getElementById('welcome').innerText = "Treinador: " + u;
      render();
    };

    // Renderizar
    function render() {
      const lista = document.getElementById('lista-pokemon');
      lista.innerHTML = '';
      for(let i=1; i<=151; i++) { // G1 para exemplo rápido
        const card = document.createElement('div');
        card.className = `pokemon-card ${userDoc.capturados[i] ? 'capturado' : ''}`;
        card.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${i}.png">
                          <b>${listaNomes[i]}</b>`;
        
        // Clique curto: Captura / Clique longo: Ver Cartas
        card.onclick = () => alternarCaptura(i, card);
        card.oncontextmenu = (e) => { e.preventDefault(); abrirTCG(listaNomes[i]); };
        
        lista.appendChild(card);
      }
    }

    async function alternarCaptura(id, el) {
      userDoc.capturados[id] = !userDoc.capturados[id];
      el.classList.toggle('capturado');
      await setDoc(doc(db, "treinadores", userDoc.nome), userDoc);
    }

    async function abrirTCG(nome) {
      const modal = document.getElementById('modal-tcg');
      const corpo = document.getElementById('modal-lista');
      document.getElementById('modal-titulo').innerText = "Cartas de " + nome;
      modal.style.display = 'flex';
      corpo.innerHTML = "Buscando pacotes...";

      try {
        const r = await fetch(`https://api.pokemontcg.io/v2/cards?q=name:${nome}`);
        const d = await r.json();
        corpo.innerHTML = "";
        d.data.slice(0, 10).forEach(c => {
          corpo.innerHTML += `<div class="carta-item">
            <img src="${c.images.small}">
            <div style="font-size:10px">${c.set.name}</div>
          </div>`;
        });
      } catch(e) { corpo.innerHTML = "Erro ao carregar TCG."; }
    }

    window.onscroll = () => { document.getElementById('btn-topo').style.display = window.scrollY > 400 ? 'block' : 'none'; };
    init();
  </script>
</body>
</html>